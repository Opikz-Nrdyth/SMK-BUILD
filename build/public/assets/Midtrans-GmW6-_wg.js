import{u as M,c as o,j as s,L as w,r as h}from"./app-D-AlCsI9.js";import{N as B}from"./Notification-DkVvHERy.js";import{D as v}from"./TabelData-DK3QOFq1.js";import{M as R}from"./ModalView-DuQ8G--3.js";import{S as E}from"./SuperAdminLayouts-DDh0Gaam.js";import{G as C}from"./GuruLayouts-D90zMq1r.js";import{S as G}from"./StafLayouts-DNWQaC5q.js";import{D as U}from"./luxon-n6HvnmwO.js";import"./FormatWaktu-CaIpskCQ.js";import"./Breadcrump-CQG3d_M-.js";function q({auth:A,transactions:u,pagination:r,filter:l}){const{props:c}=M(),[D,S]=o.useState([]),[t,d]=o.useState(null),[N,b]=o.useState(null),[V,P]=o.useState((r==null?void 0:r.currentPage)||1),[f,I]=o.useState((l==null?void 0:l.search)||"");o.useEffect(()=>{if(!u)return;const e=u.map(a=>{const n=U.fromISO(a.transactionTime).toFormat("dd LLL yyyy, HH:mm"),i=y(parseFloat(a.grossAmount)),m=p(a.transactionStatus);return{id:a.id,siswa:a.userName,nisn:a.nisn,jenisPembayaran:a.jenisPembayaran,nominal:i,waktu:a.transactionTime,status:s.jsxDEV("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${m}`,children:a.transactionStatus.toUpperCase()},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:60,columnNumber:11},this),statusText:a.transactionStatus.toUpperCase(),detailData:{"Order ID":a.id,Pembayar:a.userName,NISN:a.nisn,"Jenis Tagihan":a.jenisPembayaran,"Nominal Bayar":i,Status:a.transactionStatus.toUpperCase(),"Waktu Transaksi":n,"ID Tagihan Lokal":a.pembayaranId},rawData:a}});S(e),P((r==null?void 0:r.currentPage)||1)},[u,r]);const y=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),p=e=>{switch(e){case"settlement":case"capture":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"pending":case"authorize":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"expire":case"cancel":case"deny":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},g=e=>{h.get(String(c.pattern),{page:e,search:f},{preserveState:!0,replace:!0})};o.useEffect(()=>{const e=async()=>{const a=await fetch(`/api/midtrans/status-proxy/${t==null?void 0:t.id}`,{method:"GET",headers:{}});if(a.ok){const n=await a.json(),i=j(t),m={orderId:n.order_id,idPembayaran:n.custom_field2,Pembayar:i==null?void 0:i.Pembayar,nominalBayar:y(n.gross_amount),jenisTagihan:t==null?void 0:t.jenisPembayaran,status:n.transaction_status,waktuTransaksi:n.transaction_time,metodePembayaran:n.payment_type,Pesan:n.status_message};b(m)}};t!=null&&t.id&&e()},[t]);const k=e=>{I(e),h.get(String(c.pattern),{page:1,search:e},{preserveState:!0,replace:!0,preserveScroll:!0})},j=e=>e!=null&&e.detailData?e.detailData:{},x=c.user.role,T=x==="Guru"?C:x==="Staf"?G:E;return s.jsxDEV(T,{children:s.jsxDEV("div",{className:"max-w-7xl mx-auto lg:p-6",children:[s.jsxDEV(B,{},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:183,columnNumber:9},this),s.jsxDEV("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:s.jsxDEV("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Record Pembayaran Online"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:186,columnNumber:11},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:185,columnNumber:9},this),s.jsxDEV(v,{data:D,tabelName:"Record Pembayaran Online",columns:[{header:"Order ID",accessor:"id"},{header:"Siswa",accessor:"siswa"},{header:"Tagihan",accessor:"jenisPembayaran"},{header:"Nominal",accessor:"nominal"},{header:"Waktu Transaksi",accessor:"waktu",isTime:{mode:"datetime",withDay:!0}},{header:"Status",accessor:"status"},{header:"Cetak",accessor:"id",action:e=>s.jsxDEV(s.Fragment,{children:e.statusText=="PENDING"&&s.jsxDEV(w,{href:`/api/midtrans/${e.id}/cancel`,className:"text-red-600 hover:text-red-800 px-2 font-bold py-1 rounded-md flex items-center gap-1 transition-colors duration-200",children:"Cancel"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:211,columnNumber:21},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:209,columnNumber:17},this)}],pageSize:15,placeholder:"Cari berdasarkan Order ID, Nama Siswa, atau NISN...",noDataText:"Tidak ada record pembayaran online",onRowClick:e=>d(e),editable:"true",serverPagination:{currentPage:(r==null?void 0:r.currentPage)||1,lastPage:(r==null?void 0:r.lastPage)||1,total:(r==null?void 0:r.total)||0,onPageChange:g},disableConfig:{canEdit:()=>!1,canDelete:()=>!1,canView:()=>!0,disabledMessage:"Guru hanya dapat mengubah Ujian Mandiri yang dibuat sendiri"},serverSearch:{value:f,onChange:k}},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:191,columnNumber:9},this),s.jsxDEV(R,{data:N,open:!!N,onClose:()=>{d(null),b(null)},title:"Detail Transaksi Midtrans",exclude:["id","pembayaranId"]},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:249,columnNumber:9},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:182,columnNumber:7},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Pembayaran/Midtrans.tsx",lineNumber:181,columnNumber:5},this)}export{q as default};
