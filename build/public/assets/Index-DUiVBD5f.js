import{u as O,c as n,r as d,j as a,L as B}from"./app-Bzs2Gd0p.js";import{N as F}from"./Notification-BZaUPjAP.js";import{D as z}from"./TabelData-Cg-6qyrD.js";import{M as H}from"./ModalView-CgG3FUle.js";import{S as W}from"./SuperAdminLayouts-B2SIYU2P.js";import{o as x}from"./offline_storage_service-gwYtBtk4.js";import{G as _}from"./GuruLayouts-Ci9JThou.js";import"./FormatWaktu-CaIpskCQ.js";import"./Breadcrump-CXoRlEgY.js";function q({auth:c,absensi:u,accessibleKelas:y,accessibleMapel:T,filter:s,absensiPaginate:i,searchQuery:E=""}){const{props:l}=O(),[w,M]=n.useState([]),[h,S]=n.useState(),[R,f]=n.useState((i==null?void 0:i.currentPage)||1),[G,J]=n.useState((i==null?void 0:i.lastPage)||1),[p,k]=n.useState(E),[o,D]=n.useState({kelasId:(s==null?void 0:s.kelasId)||"",tanggal:(s==null?void 0:s.tanggal)||new Date().toISOString().split("T")[0],mapelId:(s==null?void 0:s.mapelId)||""}),[b,v]=n.useState(0),[I,A]=n.useState(navigator.onLine),[m,K]=n.useState(null);n.useEffect(()=>{if(!u)return;const e=[];u==null||u.forEach(r=>{e.push({id:r.id,siswa:r.userName,mataPelajaran:r.mapelName,kelas:r.kelasName,status:r.status,hari:r.hari?new Date(r.hari).toLocaleDateString("id-ID"):"-",createdAt:r.createdAt,userId:r.userId,mapelId:r.mapelId,kelasId:r.kelasId,syncStatus:"synced"})}),M(e)},[u]),n.useEffect(()=>{const e=()=>A(!0),r=()=>A(!1);return window.addEventListener("online",e),window.addEventListener("offline",r),j(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r),m&&clearTimeout(m)}},[]);const j=async()=>{if(x.isStorageSupported())try{const e=await x.getPendingAbsensi();v(e.length)}catch(e){console.error("Error checking pending data:",e)}},P=e=>{d.get(`${String(l.pattern)}`,{page:e,...o,search:p},{preserveState:!0,replace:!0}),f(e)},V=e=>{k(e),d.get(`${String(l.pattern)}`,{page:1,...o,search:e},{preserveState:!0,replace:!0,preserveScroll:!0}),f(1)},g=n.useCallback((e,r)=>{const t={...o,[e]:r};D(t),m&&clearTimeout(m);const N=setTimeout(()=>{d.get(`${String(l.pattern)}`,{...t,search:p},{preserveState:!0,replace:!0,only:["absensi","accessibleKelas","filter","absensiPaginate"]})},500);K(N)},[o,m,p]),U=async()=>{if(!I){alert("Tidak dapat sinkronisasi saat offline");return}try{const e=await x.getPendingAbsensi();if(e.length===0){alert("Tidak ada data yang menunggu sinkronisasi");return}const r={absensi:e.map(t=>({userId:t.userId,mapelId:t.mapelId,kelasId:t.kelasId,status:t.status,hari:t.hari}))};d.post(`${String(l.pattern)}/bulk`,r,{onSuccess:async()=>{const t=e.map(N=>N.id).filter(N=>N!==void 0);await x.markAsSynced(t),v(0),alert(`Berhasil menyinkronisasi ${e.length} data absensi`),d.reload()},onError:t=>{console.error("Sync error:",t),alert("Gagal menyinkronisasi data. Silakan coba lagi.")}})}catch(e){console.error("Gagal sinkronisasi:",e),alert("Gagal menyinkronisasi data. Silakan coba lagi.")}},C=y.map(e=>({label:e.namaKelas,value:e.id})),L=T.map(e=>({label:e.namaMataPelajaran,value:e.id})),$=e=>{switch(e==null?void 0:e.toLowerCase()){case"hadir":return"bg-green-100 text-green-800 border-green-300";case"izin":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"sakit":return"bg-blue-100 text-blue-800 border-blue-300";case"alpha":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}};return a.jsxDEV("div",{className:"max-w-7xl mx-auto lg:p-6",children:[a.jsxDEV(F,{},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:221,columnNumber:7},this),a.jsxDEV("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[a.jsxDEV("div",{children:a.jsxDEV("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Data Absensi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:226,columnNumber:11},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:225,columnNumber:9},this),a.jsxDEV("div",{className:"flex space-x-3",children:[b>0&&I&&a.jsxDEV("button",{onClick:U,className:"px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 flex items-center space-x-2 transition-colors duration-200",children:[a.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:235,columnNumber:17},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:234,columnNumber:15},this),a.jsxDEV("span",{children:["Sync Now (",b,")"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:242,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:230,columnNumber:13},this),a.jsxDEV(B,{href:`${String(l.pattern)}/create`,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors duration-200",children:"Tambah Absensi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:245,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:228,columnNumber:9},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:224,columnNumber:7},this),a.jsxDEV("div",{className:`my-2 text-sm ${I?"text-green-600":"text-pink-500"}`,children:["Status: ",I?"Online":"Offline",b>0&&a.jsxDEV("span",{className:"ml-2 text-purple-600 font-medium",children:["â€¢ ",b," data menunggu sinkronisasi"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:256,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:253,columnNumber:7},this),a.jsxDEV("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6 border border-purple-200 dark:border-purple-800",children:a.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Tanggal"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:266,columnNumber:13},this),a.jsxDEV("input",{type:"date",value:o.tanggal,onChange:e=>g("tanggal",e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border dark:text-gray-50 border-purple-300 dark:bg-gray-700 dark:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md transition-colors duration-200"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:269,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:265,columnNumber:11},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Kelas"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:277,columnNumber:13},this),a.jsxDEV("select",{value:o.kelasId,onChange:e=>g("kelasId",e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border dark:text-gray-50 border-purple-300 dark:bg-gray-700 dark:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md transition-colors duration-200",children:[a.jsxDEV("option",{value:"",children:"Semua Kelas"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:285,columnNumber:15},this),C.map(e=>a.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:287,columnNumber:17},this))]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:280,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:276,columnNumber:11},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Mapel"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:294,columnNumber:13},this),a.jsxDEV("select",{value:o.mapelId,onChange:e=>g("mapelId",e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border dark:text-gray-50 border-purple-300 dark:bg-gray-700 dark:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md transition-colors duration-200",children:[a.jsxDEV("option",{value:"",children:"Semua Mapel"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:302,columnNumber:15},this),L.map(e=>a.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:304,columnNumber:17},this))]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:297,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:293,columnNumber:11},this),a.jsxDEV("div",{className:"flex items-end space-x-2",children:[a.jsxDEV("button",{onClick:()=>{const e={kelasId:"",tanggal:new Date().toISOString().split("T")[0]};D(e),k(""),d.get(`${String(l.pattern)}`,e,{preserveState:!0,replace:!0})},className:"px-4 py-2 text-nowrap bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors duration-200",children:"Reset Filter"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:311,columnNumber:13},this),a.jsxDEV("button",{onClick:j,className:"px-4 py-2 text-nowrap bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-colors duration-200",children:"Refresh Status"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:325,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:310,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:264,columnNumber:9},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:263,columnNumber:7},this),a.jsxDEV(z,{data:w,tabelName:"Absensi",columns:[{header:"Siswa",accessor:"siswa"},{header:"Mata Pelajaran",accessor:"mataPelajaran"},{header:"Kelas",accessor:"kelas"},{header:"Status",accessor:"status",render:e=>a.jsxDEV("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${$(e)}`,children:e},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:346,columnNumber:15},this)},{header:"Hari",accessor:"hari",isTime:{mode:"date",withDay:!0}},{header:"Aksi",accessor:"actions",action:e=>a.jsxDEV(B,{href:`${String(l.pattern)}/${e.userId}/siswa`,className:"text-purple-600 hover:text-purple-800 px-2 py-1 rounded-md flex items-center gap-1 transition-colors duration-200",children:[a.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:367,columnNumber:19},this),a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:373,columnNumber:19},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:366,columnNumber:17},this),"Lihat Semua"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:362,columnNumber:15},this)}],editable:`${String(l.pattern)}`,pageSize:15,placeholder:"Cari absensi berdasarkan siswa, atau status...",noDataText:"Tidak ada data absensi",onRowClick:e=>S(e),serverPagination:{currentPage:R,lastPage:G,total:(i==null?void 0:i.total)||0,onPageChange:P},serverSearch:{value:p,onChange:V}},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:335,columnNumber:7},this),a.jsxDEV(H,{data:h,exclude:["user","mapel","kelas","userName","mapelName","kelasName","userId","mapelId","kelasId","syncStatus"],open:!!h,onClose:()=>S(null),title:"Detail Absensi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:402,columnNumber:7},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:220,columnNumber:5},this)}q.layout=c=>(c.props.activeRole??c.props.user.role)=="Guru"?a.jsxDEV(_,{children:c},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:427,columnNumber:12},void 0):a.jsxDEV(W,{children:c},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Index.tsx",lineNumber:430,columnNumber:10},void 0);export{q as default};
