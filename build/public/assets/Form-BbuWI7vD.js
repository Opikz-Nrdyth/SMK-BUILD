import{b as $,u as C,c as r,r as v,j as e}from"./app-iNLJP6JY.js";import{U as D}from"./UniversalInput-DM4_R_Pm.js";import{o as c}from"./offline_storage_service-gwYtBtk4.js";import{N as L}from"./Notification-zJpG5Gi6.js";import"./index-BzCDgUCn.js";import"./TextEditor-DzcaE8um.js";/* empty css                  */function _({initialValues:y,onSubmit:O,submitLabel:H,dark:h=!1,kelasOptions:E,mapelOptions:P,today:w}){var B;const{data:t,setData:l,processing:A,errors:q}=$(y||{tanggal:w,kelasId:"",mapelId:"",absensi:[]}),{props:x}=C(),g=x==null?void 0:x.pattern.split("/").filter(a=>a!=""),[u,S]=r.useState([]),[o,j]=r.useState(typeof navigator<"u"?navigator.onLine:!0),[k,N]=r.useState("idle"),[d,G]=r.useState(!1),[b,p]=r.useState(0);r.useEffect(()=>{G(c.isStorageSupported())},[]),r.useEffect(()=>{if(typeof window>"u")return;const a=()=>j(!0),n=()=>j(!1);return window.addEventListener("online",a),window.addEventListener("offline",n),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",n)}},[]),r.useEffect(()=>{t.kelasId?K(t.kelasId):(S([]),l("absensi",[]))},[t.kelasId]),r.useEffect(()=>{o&&d&&F()},[o,d]);const K=async a=>{try{const n=await fetch(`siswa/${a}`);if(!n.ok)throw new Error("Failed to fetch siswa data");const i=await n.json();S(i),l("absensi",i)}catch(n){console.error("Gagal memuat data siswa:",n),alert("Gagal memuat data siswa. Silakan coba lagi.")}},F=async()=>{try{const a=await c.getPendingAbsensi();p(a==null?void 0:a.length)}catch(a){console.error("Error checking pending data:",a)}},T=(a,n)=>{const i=t.absensi.map(s=>s.userId===a?{...s,status:n}:s);l("absensi",i)},M=async a=>{var n;if(a.preventDefault(),!t.kelasId||!t.mapelId||((n=t.absensi)==null?void 0:n.length)===0){alert("Harap lengkapi semua field dan pastikan ada data siswa");return}try{if(!o&&d){const i=await c.getPendingAbsensi(),s=t.absensi.map(m=>({userId:m.userId,mapelId:t.mapelId,kelasId:t.kelasId,status:m.status,hari:t.tanggal})),I=s.filter(m=>!i.some(f=>f.userId===m.userId&&f.mapelId===m.mapelId&&f.kelasId===m.kelasId&&f.hari===m.hari));if(I.length===0){alert("Semua data yang akan disimpan sudah ada dalam antrian offline.");return}if(I.length<s.length){const m=s.length-I.length;if(!confirm(`${m} data sudah ada dalam antrian offline. Hanya ${I.length} data baru yang akan disimpan. Lanjutkan?`))return}await c.saveAbsensi(s);const R=b+(s==null?void 0:s.length);p(R),alert(`Data absensi berhasil disimpan secara offline (${s==null?void 0:s.length} record). Data akan disinkronisasi otomatis saat online.`),l("kelasId",""),l("mapelId",""),l("absensi",[]),S([])}else!o&&!d?alert("Browser tidak mendukung penyimpanan offline. Silakan gunakan browser lain atau pastikan koneksi internet tersedia."):v.post(`/${g[0]}/${g[1]}`,t)}catch(i){console.error("Gagal menyimpan data absensi:",i),alert(`Gagal menyimpan data: ${i.message}`)}finally{}};r.useEffect(()=>{o&&d&&b>0&&U()},[o,d,b]);const U=async()=>{try{N("syncing");const a=await c.getPendingAbsensi(),n={absensi:a.map(i=>({userId:i.userId,mapelId:i.mapelId,kelasId:i.kelasId,status:i.status,hari:i.hari}))};(a==null?void 0:a.length)>0?v.post(`${g[0]}/${g[1]}/bulk`,n,{onSuccess:async()=>{const i=a.map(s=>s.id).filter(s=>s!==void 0);await c.markAsSynced(i),p(0),N("success"),setTimeout(()=>N("idle"),3e3),setTimeout(()=>{c.clearSyncedData().catch(console.error)},5e3)}}):(p(0),N("idle"))}catch(a){console.error("Gagal sinkronisasi data:",a),N("error"),setTimeout(()=>N("idle"),3e3)}},V=[{label:"Hadir",value:"Hadir"},{label:"Sakit",value:"Sakit"},{label:"Alfa",value:"Alfa"},{label:"Izin",value:"Izin"},{label:"PKL",value:"PKL"}];return e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV(L,{},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:258,columnNumber:7},this),e.jsxDEV("div",{className:`p-3 rounded-md ${o?"bg-green-100 dark:bg-gray-700 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("div",{children:[e.jsxDEV("span",{className:"font-medium",children:"Status: "},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:268,columnNumber:13},this),o?"Online":"Offline",!d&&" (Offline storage tidak didukung)",b>0&&e.jsxDEV("span",{className:"ml-2 text-purple-600",children:["- ",b," data menunggu sinkronisasi"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:272,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:267,columnNumber:11},this),k==="syncing"&&e.jsxDEV("span",{className:"text-purple-600 animate-pulse",children:"Menyinkronisasi..."},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:278,columnNumber:13},this),k==="success"&&e.jsxDEV("span",{className:"text-green-600",children:"✓ Berhasil disinkronisasi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:281,columnNumber:13},this),k==="error"&&e.jsxDEV("span",{className:"text-red-600",children:"✗ Gagal sinkronisasi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:283,columnNumber:38},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:266,columnNumber:9},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:259,columnNumber:7},this),e.jsxDEV("div",{children:e.jsxDEV("span",{className:"font-medium dark:text-white",children:"Pesan: "},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:288,columnNumber:9},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:287,columnNumber:7},this),e.jsxDEV("form",{onSubmit:M,className:"space-y-6",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxDEV(D,{type:"date",name:"tanggal",label:"Tanggal",value:t.tanggal,onChange:a=>l("tanggal",a),required:!0,dark:h},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:294,columnNumber:11},this),e.jsxDEV(D,{type:"select",name:"kelasId",label:"Kelas",value:t.kelasId,onChange:a=>l("kelasId",a),options:E||[],required:!0,dark:h},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:304,columnNumber:11},this),e.jsxDEV(D,{type:"select",name:"mapelId",label:"Mata Pelajaran",value:t.mapelId,onChange:a=>l("mapelId",a),options:P||[],required:!0,dark:h},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:315,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:293,columnNumber:9},this),(u==null?void 0:u.length)>0&&e.jsxDEV("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsxDEV("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxDEV("h3",{className:"text-lg font-medium  text-gray-900 dark:text-white dark:text-white",children:["Data Siswa - ",u==null?void 0:u.length," siswa"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:331,columnNumber:15},this),e.jsxDEV("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Pilih status kehadiran untuk setiap siswa"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:334,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:330,columnNumber:13},this),e.jsxDEV("div",{className:"overflow-x-auto",children:e.jsxDEV("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsxDEV("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxDEV("tr",{children:[e.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium  text-gray-500 dark:text-gray-100 uppercase tracking-wider",children:"NISN"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:342,columnNumber:21},this),e.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium  text-gray-500 dark:text-gray-100 uppercase tracking-wider",children:"Nama Siswa"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:345,columnNumber:21},this),e.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium  text-gray-500 dark:text-gray-100 uppercase tracking-wider",children:"Status Kehadiran"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:348,columnNumber:21},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:341,columnNumber:19},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:340,columnNumber:17},this),e.jsxDEV("tbody",{className:"bg-white dark:bg-gray-800 divide-y ",children:u.map((a,n)=>{var i;return e.jsxDEV("tr",{className:"hover:bg-gray-50 hover:bg-gray-700",children:[e.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap text-sm  text-gray-900 dark:text-white",children:a.nisn},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:356,columnNumber:23},this),e.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap text-sm  text-gray-900 dark:text-white",children:a.fullName},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:359,columnNumber:23},this),e.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxDEV("select",{value:((i=t.absensi[n])==null?void 0:i.status)||"Hadir",onChange:s=>T(a.userId,s.target.value),className:"block w-full pl-3 pr-10 py-2 text-base dark:bg-gray-900 dark:text-white border-gray-300 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md",children:V.map(s=>e.jsxDEV("option",{value:s.value,children:s.label},s.value,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:371,columnNumber:29},this))},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:363,columnNumber:25},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:362,columnNumber:23},this)]},a.userId,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:355,columnNumber:21},this)})},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:353,columnNumber:17},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:339,columnNumber:15},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:338,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:329,columnNumber:11},this),e.jsxDEV("div",{className:"flex justify-end pt-6 border-t border-gray-200",children:e.jsxDEV("button",{type:"submit",disabled:A||!t.kelasId||!t.mapelId||((B=t.absensi)==null?void 0:B.length)===0,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2",children:A?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:394,columnNumber:17},this),e.jsxDEV("span",{children:"Menyimpan..."},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:395,columnNumber:17},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:393,columnNumber:15},this):o?e.jsxDEV("span",{children:"Simpan ke Database"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:398,columnNumber:15},this):e.jsxDEV("span",{children:"Simpan ke Offline Storage"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:400,columnNumber:15},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:387,columnNumber:11},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:386,columnNumber:9},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:291,columnNumber:7},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/Absensi/Form.tsx",lineNumber:257,columnNumber:5},this)}export{_ as default};
