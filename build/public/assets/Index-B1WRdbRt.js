import{u as U,c as t,r as d,j as a,L as C}from"./app-CzSEP_ni.js";import{N as L}from"./Notification-DwndurhI.js";import{D as O}from"./TabelData-DM5Qq9wK.js";import{M as F}from"./ModalView-UBVBqd_2.js";import{S as $}from"./SuperAdminLayouts-pXnwNkxQ.js";import{o as I}from"./offline_storage_service-C1zgywfS.js";import{G as H}from"./GuruLayouts-CRRkik1q.js";import"./FormatWaktu-CaIpskCQ.js";import"./Breadcrump-CRhcX-X5.js";function z({auth:c,absensi:l,accessibleKelas:j,filter:o,absensiPaginate:n,searchQuery:B=""}){const{props:i}=U(),[y,w]=t.useState([]),[g,h]=t.useState(),[T,S]=t.useState((n==null?void 0:n.currentPage)||1),[E,_]=t.useState((n==null?void 0:n.lastPage)||1),[b,f]=t.useState(B),[u,k]=t.useState({kelasId:(o==null?void 0:o.kelasId)||"",tanggal:(o==null?void 0:o.tanggal)||new Date().toISOString().split("T")[0]}),[x,D]=t.useState(0),[p,v]=t.useState(navigator.onLine),[m,R]=t.useState(null);t.useEffect(()=>{if(!l)return;const e=[];l==null||l.forEach(s=>{e.push({id:s.id,siswa:s.userName,kelas:s.kelasName,status:s.status,hari:s.hari?new Date(s.hari).toLocaleDateString("id-ID"):"-",createdAt:s.createdAt,userId:s.userId,kelasId:s.kelasId,syncStatus:"synced"})}),w(e)},[l]),t.useEffect(()=>{const e=()=>v(!0),s=()=>v(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),A(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s),m&&clearTimeout(m)}},[]);const A=async()=>{if(I.isStorageSupported())try{const e=await I.getPendingAbsensi();D(e.length)}catch(e){console.error("Error checking pending data:",e)}},G=e=>{d.get(String(i.pattern),{page:e,...u,search:b},{preserveState:!0,replace:!0}),S(e)},W=e=>{f(e),d.get(String(i.pattern),{page:1,...u,search:e},{preserveState:!0,replace:!0,preserveScroll:!0}),S(1)},K=t.useCallback((e,s)=>{const r={...u,[e]:s};k(r),m&&clearTimeout(m);const N=setTimeout(()=>{d.get(String(i.pattern),{...r,search:b},{preserveState:!0,replace:!0,only:["absensi","accessibleKelas","filter","absensiPaginate"]})},500);R(N)},[u,m,b]),M=async()=>{if(!p){alert("Tidak dapat sinkronisasi saat offline");return}try{const e=await I.getPendingAbsensi();if(e.length===0){alert("Tidak ada data yang menunggu sinkronisasi");return}const s={absensi:e.map(r=>({userId:r.userId,kelasId:r.kelasId,status:r.status,hari:r.hari}))};d.post(`${String(i.pattern)}/absensi/bulk`,s,{onSuccess:async()=>{const r=e.map(N=>N.id).filter(N=>N!==void 0);await I.markAsSynced(r),D(0),alert(`Berhasil menyinkronisasi ${e.length} data absensi`),d.reload()},onError:r=>{console.error("Sync error:",r),alert("Gagal menyinkronisasi data. Silakan coba lagi.")}})}catch(e){console.error("Gagal sinkronisasi:",e),alert("Gagal menyinkronisasi data. Silakan coba lagi.")}},P=j.map(e=>({label:e.namaKelas,value:e.id})),V=e=>{switch(e==null?void 0:e.toLowerCase()){case"hadir":return"bg-green-100 text-green-800 border-green-300";case"izin":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"sakit":return"bg-blue-100 text-blue-800 border-blue-300";case"alfa":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}};return a.jsxDEV("div",{className:"max-w-7xl mx-auto lg:p-6",children:[a.jsxDEV(L,{},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:211,columnNumber:7},this),a.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[a.jsxDEV("div",{children:[a.jsxDEV("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Data Absensi Wali Kelas"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:216,columnNumber:11},this),a.jsxDEV("div",{className:`mt-2 text-sm ${p?"text-green-600":"text-pink-500"}`,children:["Status: ",p?"Online":"Offline",x>0&&a.jsxDEV("span",{className:"ml-2 text-purple-600 font-medium",children:["â€¢ ",x," data menunggu sinkronisasi"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:222,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:219,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:215,columnNumber:9},this),a.jsxDEV("div",{className:"flex space-x-3",children:[x>0&&p&&a.jsxDEV("button",{onClick:M,className:"px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 flex items-center space-x-2 transition-colors duration-200",children:[a.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:235,columnNumber:17},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:234,columnNumber:15},this),a.jsxDEV("span",{children:["Sync Now (",x,")"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:242,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:230,columnNumber:13},this),a.jsxDEV(C,{href:`${String(i.pattern)}/create`,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors duration-200",children:"Tambah Absensi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:245,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:228,columnNumber:9},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:214,columnNumber:7},this),a.jsxDEV("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6 border border-purple-200 dark:border-purple-800",children:a.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Tanggal"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:258,columnNumber:13},this),a.jsxDEV("input",{type:"date",value:u.tanggal,onChange:e=>K("tanggal",e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border dark:text-gray-50 border-purple-300 dark:bg-gray-700 dark:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md transition-colors duration-200"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:261,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:257,columnNumber:11},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Kelas"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:269,columnNumber:13},this),a.jsxDEV("select",{value:u.kelasId,onChange:e=>K("kelasId",e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border dark:text-gray-50 border-purple-300 dark:bg-gray-700 dark:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md transition-colors duration-200",children:[a.jsxDEV("option",{value:"",children:"Semua Kelas"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:277,columnNumber:15},this),P.map(e=>a.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:279,columnNumber:17},this))]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:272,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:268,columnNumber:11},this),a.jsxDEV("div",{className:"flex items-end space-x-2",children:[a.jsxDEV("button",{onClick:()=>{const e={kelasId:"",tanggal:new Date().toISOString().split("T")[0]};k(e),f(""),d.get(String(i.pattern),e,{preserveState:!0,replace:!0})},className:"px-4 py-2 text-nowrap bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors duration-200",children:"Reset Filter"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:286,columnNumber:13},this),a.jsxDEV("button",{onClick:A,className:"px-4 py-2 text-nowrap bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-colors duration-200",children:"Refresh Status"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:300,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:285,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:256,columnNumber:9},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:255,columnNumber:7},this),a.jsxDEV(O,{data:y,tabelName:"Absensi Wali Kelas",columns:[{header:"Siswa",accessor:"siswa"},{header:"Kelas",accessor:"kelas"},{header:"Status",accessor:"status",render:e=>a.jsxDEV("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${V(e)}`,children:e},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:320,columnNumber:15},this)},{header:"Hari",accessor:"hari",isTime:{mode:"date",withDay:!0}}],pageSize:15,placeholder:"Cari absensi berdasarkan siswa, kelas, atau status...",noDataText:"Tidak ada data absensi",onRowClick:e=>h(e),serverPagination:{currentPage:T,lastPage:E,total:(n==null?void 0:n.total)||0,onPageChange:G},serverSearch:{value:b,onChange:W},editable:`${String(i.pattern)}`},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:310,columnNumber:7},this),a.jsxDEV(F,{data:g,exclude:["user","kelas","userName","kelasName","userId","kelasId","syncStatus"],open:!!g,onClose:()=>h(null),title:"Detail Absensi Wali Kelas"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:350,columnNumber:7},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:210,columnNumber:5},this)}z.layout=c=>(c.props.activeRole??c.props.user.role)=="Guru"?a.jsxDEV(H,{children:c},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:364,columnNumber:12},void 0):a.jsxDEV($,{children:c},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Index.tsx",lineNumber:367,columnNumber:10},void 0);export{z as default};
