import{b as V,u as W,c as r,r as j,j as e}from"./app-nMpo0nzv.js";import{U as K}from"./UniversalInput-DhhCC8MJ.js";import{o as d}from"./offline_storage_service-C1zgywfS.js";import{N as $}from"./Notification-4m9luinP.js";import"./index-BzCDgUCn.js";import"./TextEditor-BFB8hSX5.js";/* empty css                  */function Z({accessibleKelas:B,today:v,onSubmit:O,submitLabel:L}){var A;const{data:n,setData:m,processing:k,errors:C}=V({tanggal:v,kelasId:"",absensi:[]}),{props:y}=W(),p=String(y.pattern).split("/").filter(a=>a!=""),f=`/${p[0]}/${p[1]}/${p[2]}`,[I,h]=r.useState([]),[l,D]=r.useState(navigator.onLine),[x,c]=r.useState("idle"),[u,w]=r.useState(!1),[N,b]=r.useState(0);r.useEffect(()=>{w(d.isStorageSupported())},[]),r.useEffect(()=>{const a=()=>D(!0),t=()=>D(!1);return window.addEventListener("online",a),window.addEventListener("offline",t),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",t)}},[]),r.useEffect(()=>{n.kelasId?E(n.kelasId):(h([]),m("absensi",[]))},[n.kelasId]),r.useEffect(()=>{l&&u&&P()},[l,u]);const E=async a=>{try{const t=await fetch(`${f}/siswa/${a}`);if(!t.ok)throw new Error("Failed to fetch siswa data");const i=await t.json();h(i),m("absensi",i)}catch(t){console.error("Gagal memuat data siswa:",t),alert("Gagal memuat data siswa. Silakan coba lagi.")}},P=async()=>{try{const a=await d.getPendingAbsensi();b((a==null?void 0:a.length)||0)}catch(a){console.error("Error checking pending data:",a)}},G=(a,t)=>{const i=n.absensi.map(s=>s.userId===a?{...s,status:t}:s);m("absensi",i)},F=async a=>{var t;if(a.preventDefault(),!n.kelasId||((t=n.absensi)==null?void 0:t.length)===0){alert("Harap pilih kelas dan pastikan ada data siswa");return}try{if(!l&&u){const i=await d.getPendingAbsensi(),s=n.absensi.map(o=>({userId:o.userId,kelasId:n.kelasId,status:o.status,hari:n.tanggal})),g=s.filter(o=>!i.some(S=>S.userId===o.userId&&S.kelasId===o.kelasId&&S.hari===o.hari));if(g.length===0){alert("Semua data yang akan disimpan sudah ada dalam antrian offline.");return}if(g.length<s.length){const o=s.length-g.length;if(!confirm(`${o} data sudah ada dalam antrian offline. Hanya ${g.length} data baru yang akan disimpan. Lanjutkan?`))return}await d.saveAbsensi(s);const R=N+s.length;b(R),alert(`Data absensi berhasil disimpan secara offline (${s.length} record). Data akan disinkronisasi otomatis saat online.`),m("kelasId",""),m("absensi",[]),h([])}else!l&&!u?alert("Browser tidak mendukung penyimpanan offline. Silakan gunakan browser lain atau pastikan koneksi internet tersedia."):j.post(f,n)}catch(i){console.error("Gagal menyimpan data absensi:",i),alert(`Gagal menyimpan data: ${i.message}`)}};r.useEffect(()=>{l&&u&&N>0&&T()},[l,u,N]);const T=async()=>{try{c("syncing");const a=await d.getPendingAbsensi(),t={absensi:a.map(i=>({userId:i.userId,kelasId:i.kelasId,status:i.status,hari:i.hari}))};a.length>0?j.post(`${f}/bulk`,t,{onSuccess:async()=>{const i=a.map(s=>s.id).filter(s=>s!==void 0);await d.markAsSynced(i),b(0),c("success"),setTimeout(()=>c("idle"),3e3),setTimeout(()=>{d.clearSyncedData().catch(console.error)},5e3)}}):(b(0),c("idle"))}catch(a){console.error("Gagal sinkronisasi data:",a),c("error"),setTimeout(()=>c("idle"),3e3)}},M=[{label:"Hadir",value:"Hadir"},{label:"Sakit",value:"Sakit"},{label:"Alfa",value:"Alfa"},{label:"Izin",value:"Izin"},{label:"PKL",value:"PKL"}],U=B.map(a=>({label:a.namaKelas,value:a.id}));return e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV($,{},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:235,columnNumber:7},this),e.jsxDEV("div",{className:`p-3 rounded-md ${l?"bg-green-100 dark:bg-gray-700 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("div",{children:[e.jsxDEV("span",{className:"font-medium",children:"Status: "},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:245,columnNumber:13},this),l?"Online":"Offline",!u&&" (Offline storage tidak didukung)",N>0&&e.jsxDEV("span",{className:"ml-2 text-purple-600",children:["- ",N," data menunggu sinkronisasi"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:249,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:244,columnNumber:11},this),x==="syncing"&&e.jsxDEV("span",{className:"text-purple-600 animate-pulse",children:"Menyinkronisasi..."},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:255,columnNumber:13},this),x==="success"&&e.jsxDEV("span",{className:"text-green-600",children:"✓ Berhasil disinkronisasi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:258,columnNumber:13},this),x==="error"&&e.jsxDEV("span",{className:"text-red-600",children:"✗ Gagal sinkronisasi"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:260,columnNumber:38},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:243,columnNumber:9},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:236,columnNumber:7},this),e.jsxDEV("form",{onSubmit:F,className:"space-y-6",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxDEV(K,{type:"date",name:"tanggal",label:"Tanggal",value:n.tanggal,onChange:a=>m("tanggal",a),required:!0},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:267,columnNumber:11},this),e.jsxDEV(K,{type:"select",name:"kelasId",label:"Kelas",value:n.kelasId,onChange:a=>m("kelasId",a),options:U,required:!0},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:276,columnNumber:11},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:266,columnNumber:9},this),I.length>0&&e.jsxDEV("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsxDEV("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxDEV("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Data Siswa - ",I.length," siswa"]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:291,columnNumber:15},this),e.jsxDEV("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Pilih status kehadiran untuk setiap siswa"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:294,columnNumber:15},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:290,columnNumber:13},this),e.jsxDEV("div",{className:"overflow-x-auto",children:e.jsxDEV("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsxDEV("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxDEV("tr",{children:[e.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-100 uppercase tracking-wider",children:"NISN"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:302,columnNumber:21},this),e.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-100 uppercase tracking-wider",children:"Nama Siswa"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:305,columnNumber:21},this),e.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-100 uppercase tracking-wider",children:"Status Kehadiran"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:308,columnNumber:21},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:301,columnNumber:19},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:300,columnNumber:17},this),e.jsxDEV("tbody",{className:"bg-white dark:bg-gray-800 divide-y ",children:I.map((a,t)=>{var i;return e.jsxDEV("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:a.nisn},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:316,columnNumber:23},this),e.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:a.fullName},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:319,columnNumber:23},this),e.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxDEV("select",{value:((i=n.absensi[t])==null?void 0:i.status)||"Hadir",onChange:s=>G(a.userId,s.target.value),className:"block w-full pl-3 pr-10 py-2 text-base dark:bg-gray-900 dark:text-white border-gray-300 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md",children:M.map(s=>e.jsxDEV("option",{value:s.value,children:s.label},s.value,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:331,columnNumber:29},this))},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:323,columnNumber:25},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:322,columnNumber:23},this)]},a.userId,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:315,columnNumber:21},this)})},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:313,columnNumber:17},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:299,columnNumber:15},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:298,columnNumber:13},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:289,columnNumber:11},this),e.jsxDEV("div",{className:"flex justify-end pt-6 border-t border-gray-200",children:e.jsxDEV("button",{type:"submit",disabled:k||!n.kelasId||((A=n.absensi)==null?void 0:A.length)===0,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2",children:k?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:354,columnNumber:17},this),e.jsxDEV("span",{children:"Menyimpan..."},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:355,columnNumber:17},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:353,columnNumber:15},this):l?e.jsxDEV("span",{children:"Simpan ke Database"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:358,columnNumber:15},this):e.jsxDEV("span",{children:"Simpan ke Offline Storage"},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:360,columnNumber:15},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:347,columnNumber:11},this)},void 0,!1,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:346,columnNumber:9},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:264,columnNumber:7},this)]},void 0,!0,{fileName:"G:/Bank Project/2026/SMK-BINA-INDUSTRI/inertia/pages/AbsensiWaliKelas/Form.tsx",lineNumber:234,columnNumber:5},this)}export{Z as default};
